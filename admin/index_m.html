<html>

<head>

	<!-- Load ioBroker scripts and styles-->
	<link rel="stylesheet" type="text/css" href="../../lib/css/fancytree/ui.fancytree.min.css" />
	<link rel="stylesheet" type="text/css" href="../../css/adapter.css" />
	<link rel="stylesheet" type="text/css" href="../../lib/css/materialize.css">

	<script type="text/javascript" src="../../lib/js/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="../../socket.io/socket.io.js"></script>
	
	<script type="text/javascript" src="../../lib/js/materialize.js"></script>
	<script type="text/javascript" src="../../lib/js/jquery-ui.min.js"></script>
	<script type="text/javascript" src="../../lib/js/jquery.fancytree-all.min.js"></script>

	<script type="text/javascript" src="../../js/translate.js"></script>
	<script type="text/javascript" src="../../lib/js/selectID.js"></script>
	<script type="text/javascript" src="../../js/adapter-settings.js"></script>


	<!-- my own styles -->
	<link rel="stylesheet" type="text/css" href="style.css" />
	<script type="text/javascript" src="words.js"></script>

	<style>

        #dialog-device-edit {
            max-height: 95% !important;
            max-width: 85% !important;
            width: 80% !important;
            height: 90% !important;
            overflow: visible !important;
            top: 10px !important;
        }

		#dialog-select-member {
			max-height: 95% !important;
			max-width: 85% !important;
			width: 80% !important;
			height: 90% !important;
			overflow: visible !important;
			top: 10px !important;
		}

		.collapsible-body {
			margin-left: 2rem !important;
			padding-top: 0 !important;
		}

		redlabel {
			color: red;
		}
	</style>


	<script type="text/javascript">



		function showHideSettings() {
            console.log("showHideSettings");

            if ($('#DeviceType').val() == "EVCharger") {
                $('#page-device-wallbox').show();

                $('#DeviceTimerActive').prop("checked", false);
                $('#DeviceTimerActive').prop('disabled', true);
            }
            else {
                $('#page-device-wallbox').hide();
                $('#DeviceTimerActive').prop('disabled', false);
            }


			if ($('#DeviceInterruptionAllowed').prop("checked")) {
                //console.log("show DeviceInterruptionAllowed");
				$('#divDeviceMinOnTime').show();
				$('#divDeviceMaxOnTime').show();
				$('#divDeviceMinOffTime').show();
				$('#divDeviceMaxOffTime').show();
			}
			else {
                //console.log("hide DeviceInterruptionAllowed");
                $('#divDeviceMinOnTime').hide();
                $('#divDeviceMaxOnTime').hide();
                $('#divDeviceMinOffTime').hide();
                $('#divDeviceMaxOffTime').hide();
            }

			if ($('#DeviceMeasurementMethod').val() == "Measurement") {
                //console.log("show DeviceMeasurementMethod");
				$('#divDeviceOIDPower').show();

			}
			else {
                //console.log("hide DeviceMeasurementMethod");
                $('#divDeviceOIDPower').hide();
            }

            if ($('#DeviceStatusDetectionType').val() == "SeparateOID") {
                //console.log("show DeviceStatusDetectionType");
				$('#divDeviceOIDStatus').show();
                

            }
            else {
                //console.log("hide DeviceStatusDetectionType");
                $('#divDeviceOIDStatus').hide();
            }

			
            if ($('#DeviceHasOIDSwitch').prop("checked")) {
                //console.log("show DeviceHasOIDSwitch");
                $('#divDeviceOIDSwitch').show();

            }
            else {
                //console.log("hide DeviceHasOIDSwitch");
                $('#divDeviceOIDSwitch').hide();
			}

            if ($('#DeviceStatusDetectionType').val() == "FromPowerValue" ) {
                $('#divDeviceStatusDetectionLimit').show();
            }
            else {
                $('#divDeviceStatusDetectionLimit').hide();
            }

			/*
			 * only if detection from power value, otherwise we believe what we get
            if ($('#DeviceStatusDetectionType').val() == "FromPowerValue" || $('#DeviceStatusDetectionType').val() == "SeparateOID") {
				$('#divDeviceStatusDetectionLimit').show();
			}
			else {
                $('#divDeviceStatusDetectionLimit').hide();
            }
			*/

			if ($('#DeviceTimerActive').prop("checked")) {
				//console.log("show DeviceTimerActive");
				$('#divDeviceTimer').show();
				//$('#divDeviceRunningTime').show();
				//$('#divDeviceTimerEveryDay').show();
				//$('#divDeviceTimerDays').show();
				$('#divDeviceCancelRequests').show();
                $('#DeviceEnergyRequests').show();
			}
			else {
				//console.log("hide DeviceTimerActive");
				$('#divDeviceTimer').hide();
				//$('#divDeviceRunningTime').hide();
				//$('#divDeviceTimerEveryDay').hide();
				//$('#divDeviceTimerDays').hide();
				$('#divDeviceCancelRequests').hide();
                $('#DeviceEnergyRequests').hide();
			}
			
            if ($('#DeviceTimerCancelIfNotOn').prop("checked")) {
                //console.log("show DeviceTimerCancelIfNotOn");
                $('#divDeviceTimerCancelIfNotOnTime').show();
			}
			else {
                //console.log("hide DeviceTimerCancelIfNotOn");
                $('#divDeviceTimerCancelIfNotOnTime').hide();
            }
			/*
			if ($('#DeviceTimerEveryDay').prop("checked")) {
                //console.log("show DeviceTimerEveryDay");
                $('#divDeviceTimerMonday').hide();
				$('#divDeviceTimerTuesday').hide();
				$('#divDeviceTimerWednesday').hide();
				$('#divDeviceTimerThursday').hide();
				$('#divDeviceTimerFriday').hide();
				$('#divDeviceTimerSaturday').hide();
                $('#divDeviceTimerSunday').hide();
			}
			else {
                //console.log("hide DeviceTimerEveryDay");
                $('#divDeviceTimerMonday').show();
                $('#divDeviceTimerTuesday').show();
                $('#divDeviceTimerWednesday').show();
                $('#divDeviceTimerThursday').show();
                $('#divDeviceTimerFriday').show();
                $('#divDeviceTimerSaturday').show();
                $('#divDeviceTimerSunday').show();
            }
			*/

			


		}


		function CheckIP(onChange, instance) {
			console.log("CheckIP");
			var $ip = $('#IPAddress');

			if (!$ip.val() || $ip.val().length < 5) {
				console.log("call get IP from " + instance);
				getIP(onChange, instance);
			}
		}

		//var timeout1;
		function getIP(onChange, instance) {
			//timeout1 = setTimeout(function () {
			//    getIP(onChange, instance);
			//}, 4000);

			//function sendTo(_adapter_instance, command, message, callback)
			sendTo(instance, 'getIP', null, function (list) {
				//if (timeout1) {
				//    clearTimeout(timeout1);
				//    timeout1 = null;
				//}

				console.log('got ip ' + JSON.stringify(list));

				$('#IPAddress').val(list);

				showHideSettings();
				onChange(true);
				M.updateTextFields();

			});
		}



		function CheckUUID(onChange, instance) {
			console.log("CheckUUID");
			var $uuid = $('#UUID');

			if (!$uuid.val() || $uuid.val().length < 5) {
				console.log("call get UUID from " + instance);
				getUUID(onChange, instance);
			}

		}

		//var timeout2;
		function getUUID(onChange, instance) {
			//timeout2 = setTimeout(function () {
			//    getUUID(onChange, instance);
			//}, 4000);

			//function sendTo(_adapter_instance, command, message, callback)
			sendTo(instance, 'getUUID', null, function (list) {
				//if (timeout2) {
				//    clearTimeout(timeout2);
				//    timeout2 = null;
				//}

				console.log('got uuid ' + JSON.stringify(list));

				$('#UUID').val(list);

				showHideSettings();
				onChange(true);
				M.updateTextFields();

			});
		}

		function CheckDeviceBaseId(onChange, instance) {
			console.log("CheckDeviceBaseId");
			var $devicebaseid = $('#DeviceBaseID');

			if (!$devicebaseid.val() || $devicebaseid.val() < 1000) {
				console.log("call get $devicebaseid from " + instance);
				getDeviceBaseId(onChange, instance);
			}
		}

		//var timeout3;
		function getDeviceBaseId(onChange, instance) {
			//timeout3 = setTimeout(function () {
			//    getDeviceBaseId(onChange, instance);
			//}, 4000);

			//function sendTo(_adapter_instance, command, message, callback)
			sendTo(instance, 'getDeviceBaseID', null, function (list) {
				//if (timeout3) {
				//    clearTimeout(timeout3);
				//    timeout3 = null;
				//}

				console.log('got DeviceBaseID ' + JSON.stringify(list));

				$('#DeviceBaseID').val(list);

				showHideSettings();
				onChange(true);
				M.updateTextFields();

			});
		}

		let devices = null;
		let myonChange = null;

		// This will be called by the admin adapter when the settings page loads
		function load(settings, onChange) {
			// example: select elements with id=key and class=value and insert value
			if (!settings) return;
			$('.value').each(function () {
				var $key = $(this);
				var id = $key.attr('id');
				if ($key.attr('type') === 'checkbox') {
					// do not call onChange direct, because onChange could expect some arguments
					$key.prop('checked', settings[id])
						.on('change', () => onChange())
						;
				} else {
					// do not call onChange direct, because onChange could expect some arguments
					$key.val(settings[id])
						.on('change', () => onChange())
						.on('keyup', () => onChange())
						;
				}
			});
			onChange(false);
			myonChange = onChange;

			var _id = 'semp.' + instance;
			CheckIP(onChange, _id);
			CheckUUID(onChange, _id);
			CheckDeviceBaseId(onChange, _id);

			showHideSettings();

			devices = settings.devices;

			// reinitialize all the Materialize labels on the page if you are dynamically adding inputs:
			if (M) M.updateTextFields();

			values2table('devices', settings.devices, onChange, tableDevicesOnReady);

			$('#addNewDevice').on('click', function () {
				
				let temp_devices = table2values('devices');
				id = temp_devices.length;

                console.log("new device add " + id);
				setTimeout(function () {
					//define ID F-11223344-112233445566-00
					var $devicebaseid = $('#DeviceBaseID');
					var deviceid = "F-" + $devicebaseid.val() + "-" + ("000000000000" + (id + 1)).slice(-12) + "-00";

					$('#devices .values-input[data-name="Name"][data-index="' + id + '"]').val("newDevice" + id).change();
                    $('#devices .values-input[data-name="IsActive"][data-index="' + id + '"]').prop('checked', true).change();
					$('#devices .values-input[data-name="ID"][data-index="' + id + '"]').val(deviceid).change();
				}, 150);
			});


			$("#refresh-baseid").click(function () {
				getDeviceBaseId(onChange, _id);
			});

			$("#refresh-uuid").click(function () {
				getUUID(onChange, _id);
			});

			
            

		}

        let tempEnergyRequestPeriods = [];

		function initDialogDevice(id, device, callback) {

			console.log('initDialogDevice ' + device + " " + id);

			var $editDialog = $('#dialog-device-edit');
			if (!$editDialog.data('inited')) {

				console.log('init dialog ');

				$editDialog.data('inited', true);
				$editDialog.modal({
					dismissible: false
				});

				$editDialog.find('.btn-set').on('click', function () {
					var $editDialog = $('#dialog-device-edit');
					var callback = $editDialog.data('callback');
					if (typeof callback === 'function') callback();
					$editDialog.data('callback', null);
				});
			}

            $editDialog.data('callback', callback);
			$editDialog.modal('open');

            $("#DeviceInterruptionAllowed").change( function () {
                showHideSettings();
			});
            $("#DeviceMeasurementMethod").change(function () {
                showHideSettings();
			});
            $("#DeviceHasOIDSwitch").change(function () {
                showHideSettings();
            });
            $("#DeviceStatusDetectionType").change(function () {
                showHideSettings();
            });
            $("#DeviceTimerActive").change(function () {
                showHideSettings();
			});
			/*
            $("#DeviceTimerEveryDay").change(function () {
                showHideSettings();
            });
			*/
            $("#DeviceTimerCancelIfNotOn").change(function () {
                showHideSettings();
			});
            $("#DeviceType").change(function () {
                showHideSettings();
            });



			//$("#DeviceTimerDays").change(function () {
			//	console.log("DeviceTimerDays " + $("#DeviceTimerDays").val());
			//});

            $('#SelectDeviceOIDPower').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#DeviceOIDPower').val(), function (newId) {
                        if (newId) {
                            $('#DeviceOIDPower').val(newId).trigger('change');
                        }
                    });
                });
            });
            $('#SelectDeviceOIDSwitch').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#DeviceOIDSwitch').val(), function (newId) {
                        if (newId) {
                            $('#DeviceOIDSwitch').val(newId).trigger('change');
                        }
                    });
                });
			});
            $('#SelectDeviceOIDStatus').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#DeviceOIDStatus').val(), function (newId) {
                        if (newId) {
                            $('#DeviceOIDStatus').val(newId).trigger('change');
                        }
                    });
                });
            });
            $('#SelectDeviceOIDPlugConnected').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#DeviceOIDPlugConnected').val(), function (newId) {
                        if (newId) {
                            $('#DeviceOIDPlugConnected').val(newId).trigger('change');
                        }
                    });
                });
			});
            $('#SelectDeviceOIDIsCharging').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#DeviceOIDIsCharging').val(), function (newId) {
                        if (newId) {
                            $('#DeviceOIDIsCharging').val(newId).trigger('change');
                        }
                    });
                });
			});
            $('#SelectDeviceOIDIsError').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#DeviceOIDIsError').val(), function (newId) {
                        if (newId) {
                            $('#DeviceOIDIsError').val(newId).trigger('change');
                        }
                    });
                });
            });
            $('#SelectDeviceOIDChargePower').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#DeviceOIDChargePower').val(), function (newId) {
                        if (newId) {
                            $('#DeviceOIDChargePower').val(newId).trigger('change');
                        }
                    });
                });
			});
            $('#SelectDeviceOIDStartCharge').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#DeviceOIDStartCharge').val(), function (newId) {
                        if (newId) {
                            $('#DeviceOIDStartCharge').val(newId).trigger('change');
                        }
                    });
                });
			});
            $('#SelectDeviceOIDStopCharge').on('click', function () {
                initSelectId(function (sid) {
                    sid.selectId('show', $('#DeviceOIDStopCharge').val(), function (newId) {
                        if (newId) {
                            $('#DeviceOIDStopCharge').val(newId).trigger('change');
                        }
                    });
                });
            });

			//fill input elements a bit later
			setTimeout(function () {

				$('#IndexID').val(id);

				//Name, ID und IsActive aus Tabelle holen
				let temp_devices = table2values('devices');
				let deviceisActive = temp_devices[id].IsActive;
				let deviceid = temp_devices[id].ID;
				let devicename = temp_devices[id].Name;

				console.log("temp_devices " + JSON.stringify(temp_devices));


				$('#DeviceIsActive').prop("checked", deviceisActive)

				$('#DeviceID').val(deviceid);
				$('#DeviceVendor').val(devices[id].Vendor);
				$('#DeviceName').val(devicename);
				$('#DeviceType').val(devices[id].Type);
				$('#DeviceType').select();

				$('#DeviceSerialnumber').val(devices[id].SerialNr);
				$('#DeviceMaxPower').val(devices[id].MaxPower);
				$('#DeviceMinPower').val(devices[id].MinPower);
				$('#DeviceInterruptionAllowed').prop("checked", devices[id].InterruptionsAllowed);

				$('#DeviceMinOnTime').val(devices[id].MinOnTime);
				$('#DeviceMaxOnTime').val(devices[id].MaxOnTime);
				$('#DeviceMinOffTime').val(devices[id].MinOffTime);
				$('#DeviceMaxOffTime').val(devices[id].MaxOffTime);

				$('#DeviceMeasurementMethod').val(devices[id].MeasurementMethod);
				$('#DeviceMeasurementMethod').select();

				$('#DeviceOIDPower').val(devices[id].OID_Power);
				$('#DeviceMeasurementUnit').val(devices[id].MeasurementUnit);
				$('#DeviceMeasurementUnit').select();

				$('#DeviceBatteryCapacity').val(devices[id].BatteryCapacity);
				$('#DeviceOIDPlugConnected').val(devices[id].OID_PlugConnected);
				$('#DeviceOIDIsCharging').val(devices[id].OID_IsCharging);
				$('#DeviceOIDIsError').val(devices[id].OID_IsError);
				$('#DeviceOIDChargePower').val(devices[id].OID_ChargePower);
				$('#DeviceOIDStartCharge').val(devices[id].OID_StartCharge);
				$('#DeviceOIDStopCharge').val(devices[id].OID_StopCharge);

				$('#DeviceStatusDetectionType').val(devices[id].StatusDetection);
				$('#DeviceStatusDetectionType').select();
				$('#DeviceStatusDetectionLimit').val(devices[id].StatusDetectionLimit);
				$('#DeviceStatusDetectionLimitTimeOn').val(devices[id].StatusDetectionLimitTimeOn);
				$('#DeviceStatusDetectionLimitTimeOff').val(devices[id].StatusDetectionLimitTimeOff);
				$('#DeviceStatusDetectionMinRunTime').val(devices[id].StatusDetectionMinRunTime);

				$('#DeviceOIDStatus').val(devices[id].OID_Status);

				$('#DeviceHasOIDSwitch').prop("checked", devices[id].HasOIDSwitch);
				$('#DeviceOIDSwitch').val(devices[id].OID_Switch);
				$('#DeviceSwitchOffAtEndOfTimer').prop("checked", devices[id].SwitchOffAtEndOfTimer);


				$('#DeviceTimerActive').prop("checked", devices[id].TimerActive);
				/*
				$('#DeviceTimerStart').val(devices[id].TimerStart);
				$('#DeviceTimerEnd').val(devices[id].TimerEnd);
				//$('#DeviceTimerDays').val(devices[id].TimerDays);

				
				$('#DeviceTimerEveryDay').prop("checked", devices[id].TimerEveryDay);
				$('#DeviceTimerMonday').prop("checked", devices[id].TimerMonday);
				$('#DeviceTimerTuesday').prop("checked", devices[id].TimerTuesday);
				$('#DeviceTimerWednesday').prop("checked", devices[id].TimerWednesday);
				$('#DeviceTimerThursday').prop("checked", devices[id].TimerThursday);
				$('#DeviceTimerFriday').prop("checked", devices[id].TimerFriday);
				$('#DeviceTimerSaturday').prop("checked", devices[id].TimerSaturday);
				$('#DeviceTimerSunday').prop("checked", devices[id].TimerSunday);


				$('#DeviceTimerMinRunningtime').val(devices[id].TimerMinRunTime);
				$('#DeviceTimerMaxRunningtime').val(devices[id].TimerMaxRunTime);
				*/

				$('#DeviceTimerCancelIfNotOn').prop("checked", devices[id].TimerCancelIfNotOn);
				$('#DeviceTimerCancelIfNotOnTime').val(devices[id].TimerCancelIfNotOnTime);

				//=====================================================================================================
				//console.log("DeviceEnergyRequests " + JSON.stringify(devices[id]));

				//see also main.js
				//just make it backwards compatible 0.0.4 -> 0.0.3
				tempEnergyRequestPeriods = []; //clear it


				if (devices[id].EnergyRequestPeriods == null || devices[id].EnergyRequestPeriods.length == 0) {
					console.log("use old energy request data with new data structure, please save it in admin");
					//is this necessary here???

					let energyRequest = {
						ID: 1,
						Days: devices[id].TimerDays,
						EarliestStartTime: devices[id].TimerStart,
						LatestEndTime: devices[id].TimerEnd,
						MinRunTime: devices[id].TimerMinRunTime,
						MaxRunTime: devices[id].TimerMaxRunTime,
						CancelRequestNotOn: devices[id].TimerCancelIfNotOn,
						MaxTimeToOn: devices[id].TimerCancelIfNotOnTime,
						CancelRequestAfterOff: false,
						MinTimeAfterOff: "10"
					}
					tempEnergyRequestPeriods.push(energyRequest);
				}
				else {
					//bestehende noch kopieren... 
					for (let d = 0; d < devices[id].EnergyRequestPeriods.length; d++) {
						let energyRequest = {
							ID: devices[id].EnergyRequestPeriods[d].ID,
							Days: devices[id].EnergyRequestPeriods[d].Days,
							EarliestStartTime: devices[id].EnergyRequestPeriods[d].EarliestStartTime,
							LatestEndTime: devices[id].EnergyRequestPeriods[d].LatestEndTime,
							MinRunTime: devices[id].EnergyRequestPeriods[d].MinRunTime,
							MaxRunTime: devices[id].EnergyRequestPeriods[d].MaxRunTime,
							CancelRequestNotOn: devices[id].EnergyRequestPeriods[d].CancelRequestNotOn,
							MaxTimeToOn: devices[id].EnergyRequestPeriods[d].MaxTimeToOn,
							CancelRequestAfterOff: devices[id].EnergyRequestPeriods[d].CancelRequestAfterOff,
							MinTimeAfterOff: devices[id].EnergyRequestPeriods[d].MinTimeAfterOff
						}
						tempEnergyRequestPeriods.push(energyRequest);
					}
				}

				console.log("DeviceEnergyRequests " + JSON.stringify(tempEnergyRequestPeriods));

				values2table('DeviceEnergyRequests', tempEnergyRequestPeriods, myonChange, tableEnergyRequestOnReady);

				//=====================================================================================================
				// wallbox OID

				//just make it backwards compatible 0.1.0 -> 0.2.0
				tempWallboxOIDs = []; //clear it

				if (devices[id].WallboxOIDs != null) {
					tempWallboxOIDs = devices[id].WallboxOIDs;

					//todo

					//must provided -> setzen


				}
				else {
					let tempOID = "";
					let tempActive = false;

					if (devices[id].OID_PlugConnected != null && devices[id].OID_PlugConnected.length > 5) {
						tempOID = devices[id].OID_PlugConnected;
						tempActive = true;
					}
					else {
						tempOID = "";
                        tempActive = true;
					}
					wallboxOID = {
                        active: tempActive,
						must: true,
						Name: "DeviceOIDPlugConnected",
						OID: tempOID,
						Type: "Boolean",
						SetValue: "true"
					}
					tempWallboxOIDs.push(wallboxOID);

					if (devices[id].OID_IsCharging != null && devices[id].OID_IsCharging.length > 5) {
						tempOID = devices[id].OID_IsCharging;
                        tempActive = true;
					}
					else {
						tempOID = "";
						tempActive = false;
					}
					wallboxOID = {
                        active: tempActive,
						must: false,
						Name: "DeviceOIDIsCharging",
						OID: tempOID,
						Type: "Boolean",
						SetValue: "true"
					}
					tempWallboxOIDs.push(wallboxOID);

					if (devices[id].OID_IsError != null && devices[id].OID_IsError.length > 5) {
						tempOID = devices[id].OID_IsError;
                        tempActive = true;
					}
					else {
						tempOID = "";
						tempActive = false;
					}
					wallboxOID = {
                        active: tempActive,
						must: false,
						Name: "DeviceOIDIsError",
						OID: tempOID,
						Type: "Boolean",
						SetValue: "true"
					}
					tempWallboxOIDs.push(wallboxOID);

					if (devices[id].OID_ChargePower != null && devices[id].OID_ChargePower.length > 5) {
						tempOID = devices[id].OID_ChargePower;
                        tempActive = true;
					}
					else {
						tempOID = "";
                        tempActive = true;
					}
					wallboxOID = {
                        active: tempActive,
						must: true,
						Name: "DeviceOIDChargePower",
						OID: tempOID,
						Type: "Number",
						SetValue: "0"
					}
					tempWallboxOIDs.push(wallboxOID);

					if (devices[id].OID_StartCharge != null && devices[id].OID_StartCharge.length > 5) {
						tempOID = devices[id].OID_StartCharge;
                        tempActive = true;
					}
					else {
						tempOID = "";
						tempActive = false;
					}
					wallboxOID = {
                        active: tempActive,
						must: false,
						Name: "DeviceOIDStartCharge",
						OID: tempOID,
						Type: "Boolean",
						SetValue: "true"
					}
					tempWallboxOIDs.push(wallboxOID);

					if (devices[id].OID_StopCharge != null && devices[id].OID_StopCharge.length > 5) {
						tempOID = devices[id].OID_StopCharge;
                        tempActive = true;
					}
					else {
						tempOID = "";
						tempActive = false;
					}
					wallboxOID = {
                        active: tempActive,
						must: false,
						Name: "DeviceOIDStopCharge",
						OID: tempOID,
						Type: "Boolean",
						SetValue: "true"
					}
					tempWallboxOIDs.push(wallboxOID);

				}
			

                console.log("Wallbox OID " + JSON.stringify(tempWallboxOIDs));

                values2table('WallboxOid', tempWallboxOIDs, myonChange, tableWallboxOIDOnReady);

				//xxx

				//=========================================================================================================


				//let temp_values = [];

				//values2table("test", temp_values, myonChange, tableEnergyRequestOnReady);



				showHideSettings();

				if (M) M.updateTextFields();

			}, 100);


            
			
			//multiple energy requests
			
            $('#addNewRequestPeriod').on('click', function () {

                let temp_requestperiods = table2values('DeviceEnergyRequests');
                let id = temp_requestperiods.length;
				let nextId = (Number(id) + 1);
                console.log("new requst period add " + nextId);
                setTimeout(function () {
					
                    $('#DeviceEnergyRequests .values-input[data-name="ID"][data-index="' + id + '"]').val(nextId).change();
                    $('#DeviceEnergyRequests .values-input[data-name="Days"][data-index="' + id + '"]').val("everyDay").change();
                    $('#DeviceEnergyRequests .values-input[data-name="EarliestStartTime"][data-index="' + id + '"]').val("08:00").change();
                    $('#DeviceEnergyRequests .values-input[data-name="LatestEndTime"][data-index="' + id + '"]').val("13:00").change();
                    $('#DeviceEnergyRequests .values-input[data-name="MinRunTime"][data-index="' + id + '"]').val("00:30").change();
                    $('#DeviceEnergyRequests .values-input[data-name="MaxRunTime"][data-index="' + id + '"]').val("02:30").change();
                    $('#DeviceEnergyRequests .values-input[data-name="MaxTimeToOn"][data-index="' + id + '"]').val(10).change();
                    $('#DeviceEnergyRequests .values-input[data-name="MinTimeAfterOff"][data-index="' + id + '"]').val(15).change();


                    

                }, 150);
            });

            



		}

        function tableEnergyRequestOnReady() {
            console.log('tableEnergyRequestOnReady, do nothing');
		}

        function tableWallboxOIDOnReady() {
			console.log('tableWallboxOIDOnReady');
			
            $('#WallboxOid .table-wallbox_oid-div .table-values .values-buttons[data-command="edit"]').on('click', function () {
                let id = $(this).data('index');

                console.log('edit wallbox OID clicked ID=' + id + " " + $('#WallboxOid .values-input[data-name="Name"][data-index="' + id + '"]').val());

                initSelectId(function (sid) {
                    sid.selectId('show', $('#WallboxOid .values-input[data-name="OID"][data-index="' + id + '"]').val(), function (newId) {
                        if (newId) {
                            socket.emit('getObject', newId, function (err, obj) {
                                var OID = getOID(obj);
                                $('#WallboxOid .values-input[data-name="OID"][data-index="' + id + '"]').val(OID).trigger('change');
                            });
                        }
                    });
                });


			});

        }


        function getOID(obj) {
            let OID = "unknown";
            if (obj && obj._id) {
                OID = obj._id;
            }

            return OID;

        }

		function tableDevicesOnReady() {
			console.log('tableDevicesOnReady');
			$('#devices .table-values-div .table-values .values-buttons[data-command="edit"]').on('click', function () {

				let id = $(this).data('index');

				console.log('edit devices clicked ID=' + id);

				let device = $('#devices .values-input[data-name="Name"][data-index="' + id + '"]').val();
				$('#dialogEditDevice').html(device);

				setTimeout(function () {
					initDialogDevice(id, device, function () {

						//this is reached when dialog is closing
						let device = $('#dialogEditDevice')[0].innerHTML;

						let id = $('#IndexID').val();

						console.log('closing for ' + device + " " + id);

						devices[id].IsActive = $('#DeviceIsActive').prop("checked");
						devices[id].ID = $('#DeviceID').val();
						devices[id].Vendor = $('#DeviceVendor').val();
						devices[id].Name = $('#DeviceName').val();
						devices[id].Type = $('#DeviceType').val();
						devices[id].SerialNr = $('#DeviceSerialnumber').val();
						devices[id].MaxPower = $('#DeviceMaxPower').val();
                        devices[id].MinPower = $('#DeviceMinPower').val();
						devices[id].InterruptionsAllowed = $('#DeviceInterruptionAllowed').prop("checked");
						devices[id].MinOnTime = $('#DeviceMinOnTime').val();
						devices[id].MaxOnTime = $('#DeviceMaxOnTime').val();
						devices[id].MinOffTime = $('#DeviceMinOffTime').val();
						devices[id].MaxOffTime = $('#DeviceMaxOffTime').val();
						devices[id].MeasurementMethod = $('#DeviceMeasurementMethod').val();
						devices[id].OID_Power = $('#DeviceOIDPower').val();
						devices[id].MeasurementUnit = $('#DeviceMeasurementUnit').val();
                        devices[id].BatteryCapacity=$('#DeviceBatteryCapacity').val();
                        devices[id].OID_PlugConnected=$('#DeviceOIDPlugConnected').val();
                        devices[id].OID_IsCharging=$('#DeviceOIDIsCharging').val();
                        devices[id].OID_IsError=$('#DeviceOIDIsError').val();
                        devices[id].OID_ChargePower=$('#DeviceOIDChargePower').val();
                        devices[id].OID_StartCharge=$('#DeviceOIDStartCharge').val();
                        devices[id].OID_StopCharge=$('#DeviceOIDStopCharge').val();

						devices[id].StatusDetection = $('#DeviceStatusDetectionType').val();
						devices[id].StatusDetectionLimit = $('#DeviceStatusDetectionLimit').val();
						devices[id].StatusDetectionLimitTimeOn = $('#DeviceStatusDetectionLimitTimeOn').val();
						devices[id].StatusDetectionLimitTimeOff = $('#DeviceStatusDetectionLimitTimeOff').val();
						devices[id].StatusDetectionMinRunTime = $('#DeviceStatusDetectionMinRunTime').val();

						devices[id].OID_Status = $('#DeviceOIDStatus').val();

						devices[id].HasOIDSwitch = $('#DeviceHasOIDSwitch').prop("checked");
						devices[id].OID_Switch = $('#DeviceOIDSwitch').val();
						devices[id].SwitchOffAtEndOfTimer = $('#DeviceSwitchOffAtEndOfTimer').prop("checked");

						devices[id].TimerActive = $('#DeviceTimerActive').prop("checked");
						/*
						devices[id].TimerStart = $('#DeviceTimerStart').val();
						devices[id].TimerEnd = $('#DeviceTimerEnd').val();
						//devices[id].TimerDays = $('#DeviceTimerDays').val();

						devices[id].TimerEveryDay = $('#DeviceTimerEveryDay').prop("checked");
						devices[id].TimerMonday = $('#DeviceTimerMonday').prop("checked");
						devices[id].TimerTuesday = $('#DeviceTimerTuesday').prop("checked");
						devices[id].TimerWednesday = $('#DeviceTimerWednesday').prop("checked");
						devices[id].TimerThursday = $('#DeviceTimerThursday').prop("checked");
						devices[id].TimerFriday = $('#DeviceTimerFriday').prop("checked");
						devices[id].TimerSaturday = $('#DeviceTimerSaturday').prop("checked");
						devices[id].TimerSunday = $('#DeviceTimerSunday').prop("checked");

						devices[id].TimerMinRunTime = $('#DeviceTimerMinRunningtime').val();
						devices[id].TimerMaxRunTime = $('#DeviceTimerMaxRunningtime').val();
						*/
						devices[id].TimerCancelIfNotOn = $('#DeviceTimerCancelIfNotOn').prop("checked");
						devices[id].TimerCancelIfNotOnTime = $('#DeviceTimerCancelIfNotOnTime').val();

						//====================================================================================

						
						let temp_energyrequests=table2values('DeviceEnergyRequests');
						devices[id].EnergyRequestPeriods = temp_energyrequests;
                        console.log("result EnergyRequestPeriods " + JSON.stringify(devices[id].EnergyRequestPeriods));
						//====================================================================================

                        let tempWallboxOIDs = table2values('WallboxOid');
                        devices[id].WallboxOIDs = tempWallboxOIDs;
                        console.log("result wallbox oids " + JSON.stringify(devices[id].WallboxOIDs));

						CheckDeviceData(id);
						//tabelle updaten nicht notwendig, da hier keine Daten aus der Tabelle geändert werden

					})
				}, 20);
			});
		}

		function CheckDeviceData(id) {
			console.log("CheckDeviceData " + id);

			console.log(id + " " + typeof devices[id].StatusDetectionLimit + " " + devices[id].StatusDetectionLimit);
			if (typeof devices[id].StatusDetectionLimit == undefined || devices[id].StatusDetectionLimit == null || devices[id].StatusDetectionLimit == "") {
				console.log("set StatusDetectionLimit=0 ");
				devices[id].StatusDetectionLimit = 0;
			}
			console.log(id + " " + typeof devices[id].StatusDetectionLimitTimeOn + " " + devices[id].StatusDetectionLimitTimeOn);
			if (typeof devices[id].StatusDetectionLimitTimeOn == undefined || devices[id].StatusDetectionLimitTimeOn == null || devices[id].StatusDetectionLimitTimeOn == "") {
				console.log("set StatusDetectionLimitTimeOn=0 ");
				devices[id].StatusDetectionLimitTimeOn = 0;
			}
            console.log(id + " " + typeof devices[id].StatusDetectionLimitTimeOff + " " + devices[id].StatusDetectionLimitTimeOff);
            if (typeof devices[id].StatusDetectionLimitTimeOff == undefined || devices[id].StatusDetectionLimitTimeOff == null || devices[id].StatusDetectionLimitTimeOff == "") {
                console.log("set StatusDetectionLimitTimeOff=0 ");
                devices[id].StatusDetectionLimitTimeOff = 0;
			}
            console.log(id + " " + typeof devices[id].StatusDetectionMinRunTime + " " + devices[id].StatusDetectionMinRunTime);
            if (typeof devices[id].StatusDetectionMinRunTime == undefined || devices[id].StatusDetectionMinRunTime == null || devices[id].StatusDetectionMinRunTime == "") {
                console.log("set StatusDetectionMinRunTime=0 ");
                devices[id].StatusDetectionMinRunTime = 0;
			}

            console.log(id + " " + typeof devices[id].TimerCancelIfNotOnTime + " " + devices[id].TimerCancelIfNotOnTime + " " + devices[id].TimerCancelIfNotOn);
            if (typeof devices[id].TimerCancelIfNotOnTime == undefined || devices[id].TimerCancelIfNotOnTime == null || devices[id].TimerCancelIfNotOnTime == "" || Number( devices[id].TimerCancelIfNotOnTime) == 0) {

				if (typeof devices[id].TimerCancelIfNotOn == undefined || devices[id].TimerCancelIfNotOn == null || devices[id].TimerCancelIfNotOn == false) {
					console.log("set TimerCancelIfNotOnTime=0 ");
					devices[id].TimerCancelIfNotOnTime = 0;
				}
				else {
                    console.log("set TimerCancelIfNotOnTime=5 ");
                    devices[id].TimerCancelIfNotOnTime = 5;
                }
			}

            console.log(id + " " + typeof devices[id].MeasurementUnit + " " + devices[id].MeasurementUnit );
            if (typeof devices[id].MeasurementUnit == undefined || devices[id].MeasurementUnit == null || devices[id].MeasurementUnit == "" ) {

                console.log("set MeasurementUnit= W");
                devices[id].MeasurementUnit = "W";
                
            }

            
		}

		var selectId;
		function initSelectId(callback) {

			if (selectId) {
				return callback(selectId);
			}

			socket.emit('getObjects', function (err, objs) {
				selectId = $('#dialog-select-member').selectId('init', {
					noMultiselect: true,
					objects: objs,
					imgPath: '../../lib/css/fancytree/',
					filter: { type: 'state' },
					name: 'scenes-select-state',
					texts: {
						select: _('Select'),
						cancel: _('Cancel'),
						all: _('All'),
						id: _('ID'),
						name: _('Name'),
						role: _('Role'),
						room: _('Room'),
						value: _('Value'),
						selectid: _('Select ID'),
						from: _('From'),
						lc: _('Last changed'),
						ts: _('Time stamp'),
						wait: _('Processing...'),
						ack: _('Acknowledged'),
						selectAll: _('Select all'),
						unselectAll: _('Deselect all'),
						invertSelection: _('Invert selection')
					},
					columns: ['image', 'name', 'role', 'room']
				});
				callback(selectId);
			});
		}


		// This will be called by the admin adapter when the user presses the save button
		function save(callback) {
			// example: select elements with class=value and build settings object
			var obj = {};
			$('.value').each(function () {
				var $this = $(this);
				if ($this.attr('type') === 'checkbox') {
					obj[$this.attr('id')] = $this.prop('checked');
				} else if ($this.attr('type') === 'number') {
					obj[$this.attr('id')] = parseFloat($this.val());
				} else {
					obj[$this.attr('id')] = $this.val();
				}
			});

			//use devices data instead table and update from table
            let temp_devices = table2values('devices');
			for (let d = 0; d < temp_devices.length; d++) {
                devices[d].IsActive = temp_devices[d].IsActive;
                devices[d].ID = temp_devices[d].ID;
                devices[d].Name = temp_devices[d].Name;
            }

			obj.devices = devices;

			callback(obj);
		}
	</script>

</head>

<body>

	<div class="m adapter-container">
		<div class="row">

			<div class="col s12">
				<ul class="tabs">
					<li class="tab col s2"><a href="#tab-main" class="translate active">Main settings</a></li>
					<li class="tab col s2 le-settings"><a href="#tab-devices" class="translate">devices</a></li>
				</ul>
			</div>

			<!--  main - settings  -->
			<div id="tab-main" class="col s12 page">
				<div class="row">
					<div class="col s6">
						<img src="semp.png" class="logo">
					</div>
				</div>

				<div class="row">
					<div class="input-field col s3">
						<input type="text" id="IPAddress" class="value" />
						<label for="IPAddress" class="translate">IPAddress</label>
					</div>

					<div class="input-field col s3">
						<input type="text" id="UUID" class="value" />
						<label for="UUID" class="translate">UUID</label>
					</div>
					<div class="col s1">
						<button class="btn-floating btn-small waves-effect waves-light" title="refresh-uuid" id="refresh-uuid">
							<i class="material-icons">refresh</i>
						</button>
					</div>
				</div>
				<div class="row">
					<div class="input-field col s3">
						<input type="number" id="SempPort" class="value" min="0" max="9999" />
						<label for="SempPort" class="translate">SempPort</label>
					</div>
				</div>
				<div class="row">
					<div class="input-field col s3">
						<input type="text" id="SempName" class="value" />
						<label for="SempName" class="translate">SempName</label>
					</div>

					<div class="input-field col s3">
						<input type="text" id="SempManufacturer" class="value" />
						<label for="SempManufacturer" class="translate">SempManufacturer</label>
					</div>
				</div>
				<div class="row">
					<div class="input-field col s3">
						<input type="checkbox" id="extendedLog" class="value" />
						<label for="extendedLog" class="translate">extendedLog</label>
					</div>

					<div class="input-field col s3">
						<input type="checkbox" id="LogToCSV" class="value" />
						<label for="LogToCSV" class="translate">LogToCSV</label>
					</div>
					<div class="input-field col s3">
						<input type="text" id="LogToCSVPath" class="value" />
						<label for="LogToCSVPath" class="translate">LogToCSVPath</label>
					</div>


				</div>



			</div>





			<!--  settings for devices -->
			<div id="tab-devices" class="col s12 page">

				<div class="row">
					<div class="input-field col s3">
						<input type="number" id="DeviceBaseID" class="value" min="0" max="99999999" />
						<label for="DeviceBaseID" class="translate">DeviceBaseID</label>
					</div>
					<div class="col s1">
						<button class="btn-floating btn-small waves-effect waves-light" title="refresh-baseid" id="refresh-baseid">
							<i class="material-icons">refresh</i>
						</button>
					</div>
				</div>

				<div class="row">
					<div class="col s12" id="devices">

						<a id="addNewDevice" class="btn-floating waves-effect waves-light blue table-button-add" title="add device"><i class="material-icons">add</i></a>

						<div class="table-values-div">
							<table id="table_devices" class="table-values" style="width: 100%;">
								<thead>
									<tr>
										<th id="tableDevices_col1" data-name="IsActive" data-type="checkbox" style="background: #64b5f6 " class="header translate">IsActive</th>
										<th id="tableDevices_col2" data-name="ID" data-type="text" style="background: #64b5f6 " class="header translate">ID</th>
										<th id="tableDevices_col3" data-name="Name" data-type="text" style="background: #64b5f6 " class="headertranslate">Name</th>
										<th data-buttons="up down edit delete" style="width: 100px; background: #64b5f6"></th>
									</tr>
								</thead>
							</table>
						</div>

					</div>
				</div>
			</div>
		</div>

		<div class="m material-dialogs">
			<div id="dialog-select-member" class="modal modal-fixed-footer">
				<div class="modal-content">
					<div class="row">
						<div class="col s12 title"></div>
					</div>
					<div class="row">
						<div class="col s12 dialog-content">
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<a class="modal-action modal-close waves-effect waves-green btn btn-set"><i class="large material-icons left">check</i><span class="translate">Select</span></a>
					<a class="modal-action modal-close waves-effect waves-green btn btn-close"><i class="large material-icons left ">close</i><span class="translate">Cancel</span></a>
				</div>
			</div>

			<div id="dialog-device-edit" class="modal modal-fixed-footer">
				<div class="row">
					<div class="modal-content">

						<div class="row">
							<div class="col s12">
								<h6 class="title"><span class="translate">Edit Device:</span> <span id="dialogEditDevice"></span></h6>

								<!-- just to store table id / index-->
								<input type="hidden" id="IndexID" />



							</div>
						</div>
						<div class="col s12">
							<ul class="tabs">
								<li id="page-device-main" class="tab col s2"><a href="#tab-popup_device_main" class="translate" active>main settings</a></li>
								<li id="page-device-counter" class="tab col s2"><a href="#tab-popup_device_counter" class="translate">counter</a></li>
								<li id="page-device-switch" class="tab col s2"><a href="#tab-popup_device_switch" class="translate">switch</a></li>
								<li id="page-device-timers" class="tab col s2"><a href="#tab-popup_device_timers" class="translate">EnergyRequests</a></li>
								<li id="page-device-wallbox" class="tab col s2"><a href="#tab-popup_device_wallbox" class="translate">wallbox</a></li>

								<!--
				<li id="page-device-test" class="tab col s2"><a href="#tab-popup_device_test" class="translate">Test</a></li>
			-->
							</ul>
						</div>



						<!-- tab main-->
						<div id="tab-popup_device_main" class="col s12 page">
							<div class="row">
								<div class="col s12 ">
									<span class="translate">hint_main</span>
								</div>
							</div>

							<div class="row">

								<div class="input-field col s3">
									<input type="text" id="DeviceID" class="value" readonly />
									<label for="DeviceID" class="translate">DeviceID</label>
								</div>
								<div class="input-field col s3">
									<input type="text" id="DeviceName" class="value" readonly />
									<label for="DeviceName" class="translate">DeviceName</label>
								</div>
							</div>
							<div class="row">
								<div class="input-field col s3">
									<input type="text" id="DeviceVendor" class="value" />
									<label for="DeviceVendor" class="translate">DeviceVendor</label>
								</div>
								<div class="input-field col s3">
									<input type="text" id="DeviceSerialnumber" class="value" />
									<label for="DeviceSerialnumber" class="translate">DeviceSerialnumber</label>
								</div>
								<div class="input-field col s3">

									<select id="DeviceType" class="value">
										<option value="AirConditioning" class="translate">AirConditioning</option>
										<option value="Charger" class="translate">Charger</option>
										<option value="DishWasher" class="translate">DishWasher</option>
										<option value="Dryer" class="translate">Dryer</option>
										<option value="ElectricVehicle" class="translate">ElectricVehicle</option>
										<option value="EVCharger" class="translate">EVCharger</option>
										<option value="Freezer" class="translate">Freezer</option>
										<option value="Fridge" class="translate">Fridge</option>
										<option value="Heater" class="translate">Heater</option>
										<option value="HeatPump" class="translate">HeatPump</option>
										<option value="Motor" class="translate">Motor</option>
										<option value="Pump" class="translate">Pump</option>
										<option value="WashingMachine" class="translate">WashingMachine</option>
										<option value="Other" class="translate">Other</option>
									</select>
									<label for="DeviceType" class="translate">DeviceType</label>


								</div>

							</div>


							<div class="row">
								<div class="input-field col s3">
									<input type="number" id="DeviceMinPower" class="value" />
									<label for="DeviceMinPower" class="translate">DeviceMinPower</label>
								</div>
								<div class="input-field col s3">
									<input type="number" id="DeviceMaxPower" class="value" />
									<label for="DeviceMaxPower" class="translate">DeviceMaxPower</label>
								</div>
							</div>

							<div class="row">
								<div class="input-field col s3">
									<input type="checkbox" id="DeviceInterruptionAllowed" class="value" />
									<label for="DeviceInterruptionAllowed" class="translate">DeviceInterruptionAllowed</label>
								</div>
							</div>

							<div class="row">
								<div id="divDeviceMinOnTime" class="input-field col s3">
									<input type="number" id="DeviceMinOnTime" class="value" />
									<label for="DeviceMinOnTime" class="translate">DeviceMinOnTime</label>
								</div>
								<div id="divDeviceMaxOnTime" class="input-field col s3">
									<input type="number" id="DeviceMaxOnTime" class="value" />
									<label for="DeviceMaxOnTime" class="translate">DeviceMaxOnTime</label>
								</div>
								<div id="divDeviceMinOffTime" class="input-field col s3">
									<input type="number" id="DeviceMinOffTime" class="value" />
									<label for="DeviceMinOffTime" class="translate">DeviceMinOffTime</label>
								</div>
								<div id="divDeviceMaxOffTime" class="input-field col s3">
									<input type="number" id="DeviceMaxOffTime" class="value" />
									<label for="DeviceMaxOffTime" class="translate">DeviceMaxOffTime</label>
								</div>
							</div>
						</div>


						<!-- tab counter-->
						<div id="tab-popup_device_counter" class="col s12 page">
							<div class="row">
								<div class="col s12 ">
									<span class="translate">hint_counter</span>
								</div>
							</div>

							<div class="row">
								<div class="input-field col s3">
									<select id="DeviceMeasurementMethod" class="value">
										<option value="Measurement" class="translate">Measurement</option>
										<option value="Estimation" class="translate">Estimation</option>
									</select>
									<label for="DeviceMeasurementMethod" class="translate">DeviceMeasurementMethod</label>
								</div>
							</div>


							<div id="divDeviceOIDPower" class="row">
								<div class="input-field col s3">
									<input type="text" id="DeviceOIDPower" class="value" />
									<label for="DeviceOIDPower" class="translate">DeviceOIDPower</label>
								</div>

								<div class="col s1 m2 l1">
									<a id="SelectDeviceOIDPower" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">edit</i></a>
								</div>

								<div class="input-field col s2">
									<select id="DeviceMeasurementUnit" class="value">
										<option value="W">W</option>
										<option value="kW">kW</option>
									</select>
									<label for="DeviceMeasurementUnit" class="translate">DeviceMeasurementUnit</label>
								</div>

							</div>

						</div>

						<!-- tab switch-->
						<div id="tab-popup_device_switch" class="col s12 page">
							<div class="row">
								<div class="col s12 ">
									<span class="translate">hint_switch</span>
								</div>
							</div>


							<div class="row">
								<div class="input-field col s3">
									<select id="DeviceStatusDetectionType" class="value">
										<option value="SeparateOID" class="translate">SeparateOID</option>
										<option value="FromPowerValue" class="translate">FromPowerValue</option>
										<option value="AlwaysOn" class="translate">AlwaysOn</option>
									</select>
									<label for="DeviceStatusDetectionType" class="translate">DeviceStatusDetectionType</label>
								</div>
							</div>

							<div id="divDeviceOIDStatus" class="row">
								<div class="input-field col s3">
									<input type="text" id="DeviceOIDStatus" class="value" />
									<label for="DeviceOIDStatus" class="translate">DeviceOIDStatus</label>
								</div>
								<div class="col s1 m2 l1">
									<a id="SelectDeviceOIDStatus" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">edit</i></a>
								</div>
							</div>


							<div id="divDeviceStatusDetectionLimit" class="row">
								<div class="input-field col s2">
									<input type="number" id="DeviceStatusDetectionLimit" class="value" min="0" />
									<label for="DeviceStatusDetectionLimit" class="translate">DeviceStatusDetectionLimit</label>
								</div>
								<div class="input-field col s2">
									<input type="number" id="DeviceStatusDetectionLimitTimeOn" class="value" min="0" />
									<label for="DeviceStatusDetectionLimitTimeOn" class="translate">DeviceStatusDetectionLimitTimeOn</label>
								</div>
								<div class="input-field col s2">
									<input type="number" id="DeviceStatusDetectionLimitTimeOff" class="value" min="0" />
									<label for="DeviceStatusDetectionLimitTimeOff" class="translate">DeviceStatusDetectionLimitTimeOff</label>
								</div>
								<div class="input-field col s2">
									<input type="number" id="DeviceStatusDetectionMinRunTime" class="value" min="0" />
									<label for="DeviceStatusDetectionMinRunTime" class="translate">DeviceStatusDetectionMinRunTime</label>
								</div>
							</div>

							<div class="row">
								<div class="input-field col s3">
									<input type="checkbox" id="DeviceHasOIDSwitch" class="value" />
									<label for="DeviceHasOIDSwitch" class="translate">DeviceHasOIDSwitch</label>
								</div>
							</div>

							<div id="divDeviceOIDSwitch" class="row">
								<div class="input-field col s3">
									<input type="text" id="DeviceOIDSwitch" class="value" />
									<label for="DeviceOIDSwitch" class="translate">DeviceOIDSwitch</label>
								</div>
								<div class="col s1 m2 l1">
									<a id="SelectDeviceOIDSwitch" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">edit</i></a>
								</div>

								<div class="input-field col s3">
									<input type="checkbox" id="DeviceSwitchOffAtEndOfTimer" class="value" />
									<label for="DeviceSwitchOffAtEndOfTimer" class="translate">DeviceSwitchOffAtEndOfTimer</label>
								</div>

							</div>

						</div>


						<!-- tab energy requests-->
						<div id="tab-popup_device_timers" class="col s12 page">
							<div class="row">
								<div class="col s12 ">
									<span class="translate">hint_timer</span>
								</div>
							</div>

							<div class="row">
								<div class="input-field col s3">
									<input type="checkbox" id="DeviceTimerActive" class="value" />
									<label for="DeviceTimerActive" class="translate">DeviceTimerActive</label>
								</div>
							</div>

							<!--
		<div class="row">
			<div id="divDeviceTimerEveryDay" class="input-field col s1">
				<input type="checkbox" id="DeviceTimerEveryDay" class="value" />
				<label for="DeviceTimerEveryDay" class="translate">DeviceTimerEveryDay</label>
			</div>
		</div>
			-->
							<!--
		<div class="row">
			<div id="divDeviceTimerDays" class="row">
				<div id="divDeviceTimerMonday" class="input-field col s2">
					<input type="checkbox" id="DeviceTimerMonday" class="value" />
					<label for="DeviceTimerMonday" class="translate">DeviceTimerMonday</label>
				</div>
				<div id="divDeviceTimerTuesday" class="input-field col s2">
					<input type="checkbox" id="DeviceTimerTuesday" class="value" />
					<label for="DeviceTimerTuesday" class="translate">DeviceTimerTuesday</label>
				</div>
				<div id="divDeviceTimerWednesday" class="input-field col s2">
					<input type="checkbox" id="DeviceTimerWednesday" class="value" />
					<label for="DeviceTimerWednesday" class="translate">DeviceTimerWednesday</label>
				</div>
				<div id="divDeviceTimerThursday" class="input-field col s2">
					<input type="checkbox" id="DeviceTimerThursday" class="value" />
					<label for="DeviceTimerThursday" class="translate">DeviceTimerThursday</label>
				</div>
				<div id="divDeviceTimerFriday" class="input-field col s2">
					<input type="checkbox" id="DeviceTimerFriday" class="value" />
					<label for="DeviceTimerFriday" class="translate">DeviceTimerFriday</label>
				</div>
				<div id="divDeviceTimerSaturday" class="input-field col s2">
					<input type="checkbox" id="DeviceTimerSaturday" class="value" />
					<label for="DeviceTimerSaturday" class="translate">DeviceTimerSaturday</label>
				</div>
				<div id="divDeviceTimerSunday" class="input-field col s2">
					<input type="checkbox" id="DeviceTimerSunday" class="value" />
					<label for="DeviceTimerSunday" class="translate">DeviceTimerSunday</label>
				</div>
			</div>
		</div>
			-->
							<!--
				<div class="row">
					<div id="divDeviceTimer" class="row">
						<div class="input-field col s3">
							<input type="text" id="DeviceTimerStart" class="value" />
							<label for="DeviceTimerStart" class="translate">DeviceTimerStart</label>
						</div>

						<div class="input-field col s3">
							<input type="text" id="DeviceTimerEnd" class="value" />
							<label for="DeviceTimerEnd" class="translate">DeviceTimerEnd</label>
						</div>
					</div>
		-->
							<!--todo multiple select ???-->
							<!--
		<div class="input-field col s3">
			<select multiple id="DeviceTimerDays" class="value">
				<option value="everyDay" class="translate">every Day</option>
				<option value="Monday" class="translate">Monday</option>
				<option value="Tuesday" class="translate">Tuesday</option>
				<option value="Wednesday" class="translate">Wednesday</option>
				<option value="Thursday" class="translate">Thursday</option>
				<option value="Friday" class="translate">Friday</option>
				<option value="Saturday" class="translate">Saturday</option>
				<option value="Sunday" class="translate">Sunday</option>

			</select>
			<label for="DeviceTimerDays" class="translate">DeviceTimerDays</label>

		</div>
			-->
							<!--
		</div>
		-->
							<!--
		<div class="row">
			<div id="divDeviceRunningTime" class="row">
				<div class="input-field col s3">
					<input type="text" id="DeviceTimerMinRunningtime" class="value" />
					<label for="DeviceTimerMinRunningtime" class="translate">DeviceTimerMinRunningtime</label>
				</div>
				<div class="input-field col s3">
					<input type="text" id="DeviceTimerMaxRunningtime" class="value" />
					<label for="DeviceTimerMaxRunningtime" class="translate">DeviceTimerMaxRunningtime</label>
				</div>
			</div>
		</div>
			-->

							<div class="row">
								<div id="divDeviceCancelRequests" class="row">
									<div class="input-field col s3">
										<input type="checkbox" id="DeviceTimerCancelIfNotOn" class="value" />
										<label for="DeviceTimerCancelIfNotOn" class="translate">DeviceTimerCancelIfNotOn</label>
									</div>
									<div id="divDeviceTimerCancelIfNotOnTime" class="input-field col s3">
										<input type="number" id="DeviceTimerCancelIfNotOnTime" class="value" />
										<label for="DeviceTimerCancelIfNotOnTime" class="translate">DeviceTimerCancelIfNotOnTime</label>
									</div>
								</div>
							</div>

							<div class="row">
								<div class="col s12" id="DeviceEnergyRequests">
									<a id="addNewRequestPeriod" class="btn-floating waves-effect waves-light blue table-button-add" title="add request period"><i class="material-icons">add</i></a>

									<div class="table-energyrequests-div">
										<table id="table-energyrequests" class="table-values" style="width: 100%;">
											<thead>
												<tr>

													<th id="tableRequests_col1" data-name="ID" data-type="text" style="background: #64b5f6 " class="header translate">ID</th>
													<th id="tableRequests_col2" data-name="Days" data-type="select" data-options="everyDay/everyDay;Monday/Monday;Tuesday/Tuesday;Wednesday/Wednesday;Thursday/Thursday;Friday/Friday;Saturday/Saturday;Sunday/Sunday" style="background: #64b5f6 " class="header translate">Days</th>
													<th id="tableRequests_col3" data-name="EarliestStartTime" data-type="text" style="background: #64b5f6 " class="header translate">EarliestStartTime</th>
													<th id="tableRequests_col4" data-name="LatestEndTime" data-type="text" style="background: #64b5f6 " class="header translate">LatestEndTime</th>
													<th id="tableRequests_col5" data-name="MinRunTime" data-type="text" style="background: #64b5f6 " class="header translate">MinRunTime</th>
													<th id="tableRequests_col6" data-name="MaxRunTime" data-type="text" style="background: #64b5f6 " class="header translate">MaxRunTime</th>

													<th data-buttons="up down delete" style="width: 100px; background: #64b5f6"></th>
												</tr>
											</thead>
										</table>
									</div>
								</div>
							</div>
						</div>



						<!-- tab wallbox-->

						<div id="tab-popup_device_wallbox" class="col s12 page">

							<div class="row">

							</div>
							<div class="row">
								<div class="input-field col s3">
									<input type="number" id="DeviceBatteryCapacity" class="value" min="0" />
									<label for="DeviceBatteryCapacity" class="translate">DeviceBatteryCapacity</label>
								</div>
							</div>

							<!--
	<div class="row">
		<div>
			<div class="input-field col s3">
				<input type="text" id="DeviceOIDPlugConnected" class="value" />
				<label for="DeviceOIDPlugConnected" class="translate">DeviceOIDPlugConnected</label>
			</div>
			<div class="col s1 m2 l1">
				<a id="SelectDeviceOIDPlugConnected" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">edit</i></a>
			</div>
		</div>

		<div>
			<div class="input-field col s3">
				<input type="text" id="DeviceOIDIsCharging" class="value" />
				<label for="DeviceOIDIsCharging" class="translate">DeviceOIDIsCharging</label>
			</div>
			<div class="col s1 m2 l1">
				<a id="SelectDeviceOIDIsCharging" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">edit</i></a>
			</div>
		</div>

		<div>
			<div class="input-field col s3">
				<input type="text" id="DeviceOIDIsError" class="value" />
				<label for="DeviceOIDIsError" class="translate">DeviceOIDIsError</label>
			</div>
			<div class="col s1 m2 l1">
				<a id="SelectDeviceOIDIsError" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">edit</i></a>
			</div>
		</div>
	</div>
	<div class="row">
		<div>
			<div class="input-field col s3">
				<input type="text" id="DeviceOIDChargePower" class="value" />
				<label for="DeviceOIDChargePower" class="translate">DeviceOIDChargePower</label>
			</div>
			<div class="col s1 m2 l1">
				<a id="SelectDeviceOIDChargePower" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">edit</i></a>
			</div>
		</div>

		<div>
			<div class="input-field col s3">
				<input type="text" id="DeviceOIDStartCharge" class="value" />
				<label for="DeviceOIDStartCharge" class="translate">DeviceOIDStartCharge</label>
			</div>
			<div class="col s1 m2 l1">
				<a id="SelectDeviceOIDStartCharge" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">edit</i></a>
			</div>
		</div>

		<div>
			<div class="input-field col s3">
				<input type="text" id="DeviceOIDStopCharge" class="value" />
				<label for="DeviceOIDStopCharge" class="translate">DeviceOIDStopCharge</label>
			</div>
			<div class="col s1 m2 l1">
				<a id="SelectDeviceOIDStopCharge" class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">edit</i></a>
			</div>
		</div>
	</div>
		-->

							<div class="row">
								<div class="col s12" id="WallboxOid">

									<div class="table-wallbox_oid-div">
										<table id="table-wallbox_oid" class="table-values" style="width: 100%;">
											<thead>
												<tr>
													<th id="tableWallboxOID_col1" data-name="active" data-type="checkbox" style="background: #64b5f6 " class="header translate">active</th>
													<th id="tableWallboxOID_col2" data-name="must" data-type="checkbox"  style="background: #64b5f6 " class="header translate">must provided</th>
													<th id="tableWallboxOID_col3" data-name="Name" data-type="select" data-options="DeviceOIDPlugConnected/DeviceOIDPlugConnected;DeviceOIDIsCharging/DeviceOIDIsCharging;DeviceOIDIsError/DeviceOIDIsError;DeviceOIDChargePower/DeviceOIDChargePower;DeviceOIDStartCharge/DeviceOIDStartCharge;DeviceOIDStopCharge/DeviceOIDStopCharge" style="background: #64b5f6 " class="header translate">Name</th>
													<th id="tableWallboxOID_col4" data-name="OID" data-type="text" style="background: #64b5f6 " class="header translate">OID</th>
													<th id="tableWallboxOID_col5" data-buttons="edit" style="width: 100px; background: #64b5f6"></th>
													<th id="tableWallboxOID_col6" data-name="Type" data-type="select" data-options="Boolean/Boolean;Number/Number;" style="background: #64b5f6 " class="header translate">Type</th>
													<th id="tableWallboxOID_col7" data-name="SetValue" data-type="text" style="background: #64b5f6 " class="header translate">Set/CheckValue</th>
												</tr>
											</thead>
										</table>
									</div>
								</div>
							</div>
						</div>


								<!-- tab energy requests-->
								<!--
		<div id="tab-popup_device_test" class="col s12 page">
			<div class="row">
				<div class="col s12" id="test">
					<a class="btn-floating waves-effect waves-light blue table-button-add"><i class="material-icons">add</i></a>
					<div class="table-test-div">
						<table id="table_test" class="table-values" style="width: 100%;">
							<thead>
								<tr>
									<th id="test_col_0" data-name="id" style="background: #64b5f6;" class="translate">id</th>

									<th data-buttons="delete" style="width: 100px; background: #64b5f6"></th>
								</tr>
							</thead>
						</table>
					</div>
				</div>
			</div>
		</div>

			-->
							</div>
						</div>

				<div class="modal-footer">
					<a class="modal-action modal-close waves-effect waves-green btn btn-set"><i class="large material-icons left">check</i><span class="translate">Ok</span></a>
					<a class="modal-action modal-close waves-effect waves-green btn btn-close"><i class="large material-icons left">close</i><span class="translate">Cancel</span></a>
				</div>


			</div>
		</div>
	</div>
</body>

</html>